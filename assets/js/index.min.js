/* libremanga Javascript 2014-01-20 Develop and Maintain by Mark Anthony Uy. Email me at macmac.uy@gmail.com */!function(){"use strict";var a="http://www.mangaeden.com/api/manga/",b="http://www.mangaeden.com/api/chapter/",c=$("#main_header"),d=$("#wrap"),e=$(".loader"),f=$("#manga_list"),g={},h={},i=function(){$(".share_fb").on("click",function(){return window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),!1}),$(".share_twitter").on("click",function(){return window.open("https://twitter.com/share?url="+encodeURIComponent(location.href),"twitter-tweet-dialog","width=626,height=436"),!1}),$(".share_gplus").on("click",function(){return window.open("https://plus.google.com/share?url="+encodeURIComponent(location.href),"google-share-dialog","width=626,height=436"),!1})},j=!1,k=5,l=function(){var a=m(),b=$("#manga_details_wrap header");a>=k?b.addClass("fixed_top"):b.removeClass("fixed_top"),j=!1},m=function(){return d.scrollTop()},n=function(){$.ajax({type:"GET",url:"assets/templates/all.html"}).done(function(a){$("body").append(a)}).fail(function(){console.log("Failed loading template. Please refresh the page")})},o=function(a){c.append(_.template($("#manga_details").html(),a))},p=function(a){c.append(_.template($("#manga_chapter_view").html(),a)),$("img.lazy").lazyload({container:$(".modal-body"),placeholder:"../assets/img/ajax-loader.gif"})},q=function(a,b,c,d){c.removeClass("loading"),d.removeClass("disable_dom"),f.removeClass("disable_dom"),p(a),$(b).modal("show"),$("#custom_backdrop").remove()},r=function(a){$("a."+a).on("click",function(a){a.preventDefault();var c=$(this),d=c.data("chapter"),e=c.data("id"),g=c.data("manga-title"),i="#manga_chapter"+e,j=$("#manga_chapters_list"),k='<div id="custom_backdrop" class="modal-backdrop"><div class="loader"><div class="spinner"></div><span class="dark">loading...</span></div></div>';c.addClass("loading"),j.addClass("disable_dom"),f.addClass("disable_dom"),$(k).appendTo(document.body),e in h?q(h[e],i,c,j):$.ajax({url:"proxy.php?url="+encodeURIComponent(b)+e,type:"GET",dataType:"json",success:function(a){a.id=e,a.num=d,a.manga_title=g,h[e]=a}}).done(function(a,b){"success"==b?q(a,i,c,j):console.log(a,b)})})},s=function(a,b){e.hide(),f.removeClass("disable_dom"),b.removeClass("loading"),o(a),i()},t=function(a,b,c){a.hasClass(b)&&(a.removeClass(b),a.addClass(c))},u=function(){d.bind("scroll",function(){j||(j=!0,l())}),e.hide(),n(),$("a.manga").on("click",function(b){b.preventDefault(),c.empty(),e.show(),f.addClass("disable_dom");var d=$(this),h=d.data("id");if(_.each($("a.manga"),function(a,b,c){c.hasClass("current")&&c.removeClass("current")}),d.addClass("current"),d.addClass("loading"),h in g)s(g[h],d),r("manga_chapter");else{{window.location.href+"assets/json/"+h+"/manga.json"}$.ajax({url:"proxy.php?url="+encodeURIComponent(a)+h,dataType:"json",success:function(a){g[h]=a}}).done(function(a,b){"success"==b?(s(a,d),r("manga_chapter")):console.log(a,b)})}}),$(document).on("click",".modal_fullscreen",function(a){a.preventDefault();var b=$(this),c=b.closest(".modal");c.hasClass("fullscreen")?(c.removeClass("fullscreen").find(".modal-body").removeClass("mb_fullscreen"),c.find(".modal-header").removeClass("mh_fullscreen"),c.find(".modal-footer").removeClass("mf_fullscreen"),t(b.children(),"icon-resize-small","icon-resize-full"),b.attr("title","Fullscreen")):(c.addClass("fullscreen").find(".modal-body").addClass("mb_fullscreen"),c.find(".modal-header").addClass("mh_fullscreen"),c.find(".modal-footer").addClass("mf_fullscreen"),t(b.children(),"icon-resize-full","icon-resize-small"),b.attr("title","Normal screen"))}),i()};u()}();