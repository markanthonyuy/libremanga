/* libremanga Javascript 2014-01-22 Develop and Maintain by Mark Anthony Uy. Email me at macmac.uy@gmail.com */!function(){"use strict";var a="http://www.mangaeden.com/api/manga/",b="http://www.mangaeden.com/api/chapter/",c=$("#main_header"),d=$("#wrap"),e=$(".loader"),f=$("#sort_by_name"),g=$("#sort_by_hot"),h=$("#manga_list"),i={},j={},k=function(){$(".share_fb").on("click",function(){return window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),!1}),$(".share_twitter").on("click",function(){return window.open("https://twitter.com/share?url="+encodeURIComponent(location.href),"twitter-tweet-dialog","width=626,height=436"),!1}),$(".share_gplus").on("click",function(){return window.open("https://plus.google.com/share?url="+encodeURIComponent(location.href),"google-share-dialog","width=626,height=436"),!1})},l=!1,m=5,n=function(){var a=o(),b=$("#manga_details_wrap header");a>=m?b.addClass("fixed_top"):b.removeClass("fixed_top"),l=!1},o=function(){return d.scrollTop()},p=function(){$.ajax({type:"GET",url:"assets/templates/all.html"}).done(function(a){$("body").append(a),console.log("Done loading templates!")}).fail(function(){console.log("Failed loading template. Please refresh the page")})},q=function(a){c.append(_.template($("#manga_details").html(),a))},r=function(a){c.append(_.template($("#manga_chapter_view").html(),a)),$("img.lazy").lazyload({container:$(".modal-body"),placeholder:"../assets/img/ajax-loader.gif"})},s=function(a,b,c,d){c.removeClass("loading"),d.removeClass("disable_dom"),h.removeClass("disable_dom"),r(a),$(b).modal("show"),$("#custom_backdrop").remove()},t=function(a){$("a."+a).on("click",function(a){a.preventDefault();var c=$(this),d=c.data("chapter"),e=c.data("id"),f=c.data("manga-title"),g="#manga_chapter"+e,i=$("#manga_chapters_list"),k='<div id="custom_backdrop" class="modal-backdrop"><div class="loader"><div class="spinner"></div><span class="dark">loading...</span></div></div>';c.addClass("loading"),i.addClass("disable_dom"),h.addClass("disable_dom"),$(k).appendTo(document.body),e in j?s(j[e],g,c,i):$.ajax({url:"proxy.php?url="+encodeURIComponent(b)+e,type:"GET",dataType:"json",success:function(a){a.id=e,a.num=d,a.manga_title=f,j[e]=a}}).done(function(a,b){"success"==b?s(a,g,c,i):console.log(a,b)})})},u=function(a,b){e.hide(),h.removeClass("disable_dom"),b.removeClass("loading"),q(a),k()},v=function(a,b,c){a.hasClass(b)&&(a.removeClass(b),a.addClass(c))},w=function(a){$.getJSON("assets/json/manga_list.min.json").done(function(b){h.append("name"==a?_.template($("#manga_list_temp_sorted_name").html(),b):_.template($("#manga_list_temp_sorted_hot").html(),b))}).fail(function(a){console.log(a)}).always(function(){})},x=function(){f.on("click",function(a){a.preventDefault(),g.removeClass("current"),$(this).addClass("current"),h.empty(),w("name")}),g.on("click",function(a){a.preventDefault(),f.removeClass("current"),$(this).addClass("current"),h.empty(),w("hot")})},y=function(){d.bind("scroll",function(){l||(l=!0,n())}),e.hide(),p(),w(),x(),$(document).on("click","a.manga",function(b){b.preventDefault(),c.empty(),e.show(),h.addClass("disable_dom");var d=$(this),f=d.data("id");if(_.each($("a.manga"),function(a,b,c){c.hasClass("current")&&c.removeClass("current")}),d.addClass("current"),d.addClass("loading"),f in i)u(i[f],d),t("manga_chapter");else{{window.location.href+"assets/json/"+f+"/manga.json"}$.ajax({url:"proxy.php?url="+encodeURIComponent(a)+f,dataType:"json",success:function(a){i[f]=a}}).done(function(a,b){"success"==b?(u(a,d),t("manga_chapter")):console.log(a,b)})}}),$(document).on("click",".modal_fullscreen",function(a){a.preventDefault();var b=$(this),c=b.closest(".modal");c.hasClass("fullscreen")?(c.removeClass("fullscreen").find(".modal-body").removeClass("mb_fullscreen"),c.find(".modal-header").removeClass("mh_fullscreen"),c.find(".modal-footer").removeClass("mf_fullscreen"),v(b.children(),"icon-resize-small","icon-resize-full"),b.attr("title","Fullscreen")):(c.addClass("fullscreen").find(".modal-body").addClass("mb_fullscreen"),c.find(".modal-header").addClass("mh_fullscreen"),c.find(".modal-footer").addClass("mf_fullscreen"),v(b.children(),"icon-resize-full","icon-resize-small"),b.attr("title","Normal screen"))}),k()};y()}();